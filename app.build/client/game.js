/**
 * almond 0.1.4 Copyright (c) 2011, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

// Copyright 2012 Felix E. Klee <felix.klee@inka.de>

// http://www.apache.org/licenses/LICENSE-2.0

(function(){var e,t,n;(function(r){function c(e,t){var n,r,i,s,o,u,f,l,c,h,p=t&&t.split("/"),d=a.map,v=d&&d["*"]||{};if(e&&e.charAt(0)==="."&&t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(l=0;l<e.length;l+=1){h=e[l];if(h===".")e.splice(l,1),l-=1;else if(h===".."){if(l===1&&(e[2]===".."||e[0]===".."))break;l>0&&(e.splice(l-1,2),l-=2)}}e=e.join("/")}if((p||v)&&d){n=e.split("/");for(l=n.length;l>0;l-=1){r=n.slice(0,l).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=l;break}}}if(s)break;!u&&v&&v[r]&&(u=v[r],f=l)}!s&&u&&(s=u,o=f),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function h(e,t){return function(){return s.apply(r,l.call(arguments,0).concat([e,t]))}}function p(e){return function(t){return c(t,e)}}function d(e){return function(t){o[e]=t}}function v(e){if(u.hasOwnProperty(e)){var t=u[e];delete u[e],f[e]=!0,i.apply(r,t)}if(!o.hasOwnProperty(e))throw new Error("No "+e);return o[e]}function m(e,t){var n,r,i=e.indexOf("!");return i!==-1?(n=c(e.slice(0,i),t),e=e.slice(i+1),r=v(n),r&&r.normalize?e=r.normalize(e,p(t)):e=c(e,t)):e=c(e,t),{f:n?n+"!"+e:e,n:e,p:r}}function g(e){return function(){return a&&a.config&&a.config[e]||{}}}var i,s,o={},u={},a={},f={},l=[].slice;i=function(e,t,n,i){var s,a,l,c,p,y=[],b;i=i||e;if(typeof n=="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(p=0;p<t.length;p+=1){c=m(t[p],i),a=c.f;if(a==="require")y[p]=h(e);else if(a==="exports")y[p]=o[e]={},b=!0;else if(a==="module")s=y[p]={id:e,uri:"",exports:o[e],config:g(e)};else if(o.hasOwnProperty(a)||u.hasOwnProperty(a))y[p]=v(a);else if(c.p)c.p.load(c.n,h(i,!0),d(a),{}),y[p]=o[a];else if(!f[a])throw new Error(e+" missing "+a)}l=n.apply(o[e],y);if(e)if(s&&s.exports!==r&&s.exports!==o[e])o[e]=s.exports;else if(l!==r||!b)o[e]=l}else e&&(o[e]=n)},e=t=s=function(e,t,n,o,u){return typeof e=="string"?v(m(e,t).f):(e.splice||(a=e,t.splice?(e=t,t=n,n=null):e=r),t=t||function(){},typeof n=="function"&&(n=o,o=u),o?i(r,e,t,n):setTimeout(function(){i(r,e,t,n)},15),s)},s.config=function(e){return a=e,s},n=function(e,t,n){t.splice||(n=t,t=[]),u[e]=[e,t,n]},n.amd={jQuery:!0}})(),n("vendor/almond",[],function(){}),n("tiles_factory",[],function(){function t(e,t){return"rgb("+e[t]+","+e[t+1]+","+e[t+2]+")"}function n(n,r,i){var s,o,u,a,f,l,c=Math.min(r,i),h=n.getImageData(0,0,c,c).data,p=0;s=Object.create(e);for(u=0;u<c;u+=1){o=[];for(a=0;a<c;a+=1)l=4*(a*c+u),o.push({color:t(h,l)});s.push(o)}return s}function r(e,t,n){var r,i,s,o;if(t.widthT!==e.widthT||t.heightT!==e.heightT)return!1;for(r=0;r<t.length;r+=1){s=t[r],o=e[r];for(i=0;i<s.length;i+=1)if(!n(s[i],o[i]))return!1}return!0}var e;return e=Object.create([],{areEqualTo:{value:function(e){return r(this,e,function(e,t){return e===t})}},colorsAreEqualTo:{value:function(e){return r(this,e,function(e,t){return e.color===t.color})}},widthT:{get:function(){return this.length}},heightT:{get:function(){return this.widthT>0?this[0].length:0}},copy:{value:function(t){var n=Object.create(e),r;return this.forEach(function(e){n.push(e.slice())}),n}}}),Object.create(null,{load:{value:function(e,t){var r=new Image;r.onload=function(){var e=document.createElement("canvas"),i=e.getContext("2d");e.width=r.width,e.height=r.height,i.drawImage(r,0,0),t(n(i,r.width,r.height))},r.src=e}}})}),n("socket_io",[],function(){function t(){var e=document.getElementById("socketIoScript").src,t=e.match(/https?:\/\/[a-zA-Z0-9-.]*/);return t.length>=1?t[0]:""}function n(){e===undefined&&(e=io.connect(t())),e.on.apply(e,arguments)}function r(t){e&&e.socket.connected?t():n("connect",t)}var e;return Object.create(null,{emit:{value:function(){var t=arguments;r(function(){e.emit.apply(e,t)})}},on:{value:n}})}),n("hiscores_factory",["socket_io"],function(e){function r(e,t){return e!==null&&e.nRotations<=t.nRotations}function i(t){var n,r,i=!1,s=t.rawHiscores,o=t.proposal;e.emit("hiscore for "+t.boardName,o);return}function s(t){var n="hiscores for "+t.boardName;e.on(n,function(e){t.rawHiscores=e,t.version+=1})}function o(e){var o={proposal:null,version:0,rawHiscores:[],boardName:e};return s(o),Object.create(null,{forEach:{value:function(e){var n,i=0,s,u=Math.min(o.rawHiscores.length,t),a=o.proposal,f=o.rawHiscores,l=!1;for(n=0;n<u;n+=1)s=f[n+i],r(a,s)&&!l?(e(a,n,!0),i=-1,u=Math.min(u+1,t),l=!0):e(s,n,!1);if(n<t&&a!==null&&!l){e(a,n,!0);return}}},length:{get:function(){return o.rawHiscores.length}},maxNameLen:{get:function(){return 8}},nameInProposal:{set:function(e){o.proposal!==null&&(e=e.substring(0,this.maxNameLen),o.proposal.name=e,n=e)}},saveProposal:{value:function(){o.proposal!==null&&(i(o),o.proposal=null)}},propose:{value:function(e){o.proposal={name:n,rotations:e.slice(),nRotations:e.length}}},rmProposal:{value:function(){o.proposal=null}},version:{get:function(){return o.version}}})}var t=7,n="";return Object.create(null,{create:{value:o}})}),n("board_factory",["tiles_factory","hiscores_factory"],function(e,t){function r(e){return e.tiles!==undefined&&e.endTiles!==undefined}function i(e,t){Object.defineProperty(e,"sideLenT",{value:e.tiles.length}),t(e)}function s(e,t,n){Object.defineProperty(e,"tiles",{value:t}),r(e)&&i(e,n)}function o(e,t,n){Object.defineProperty(e,"endTiles",{value:t}),r(e)&&i(e,n)}function u(e,t){return"boards/"+e+"/"+t+".png"}function a(e,t,n,r,i){var s,o,u,a;s=[];for(u=t;u<=r;u+=1){o=[];for(a=n;a<=i;a+=1)o.push(e[u][a]);s.push(o)}return s}function f(e,t,n,r,i){return e[n][r-t]}function l(e,t,n,r,i){return e[i-n][t]}function c(e,t,n,r,i){return e[r-t][i-n]}function h(e,t,n){var r,i,s=t[0][0],o=t[0][1],u=t[1][0],f=t[1][1],l=u-s,c=f-o,h=a(e,s,o,u,f);for(r=s;r<=u;r+=1)for(i=o;i<=f;i+=1)e[r][i]=n(h,r-s,i-o,l,c)}function p(e,t){var n=t.rectT,r=t.cw;n.isSquare?r?h(e,n,f):h(e,n,l):h(e,n,c)}function d(e,t){p(e,t.inverse)}function v(e,t,n){t.tiles.colorsAreEqualTo(t.endTiles)?e.isFinished||(e.isFinished=!0,t.hiscores.propose(e.rotations)):(e.isFinished=!1,t.hiscores.rmProposal())}function m(r,i){var a,f={rotations:[],futureRotations:[],lastRotation:null,isFinished:!1},l=t.create(r);a=Object.create(n,{rotate:{value:function(e){n.rotate.call(this,f,e)}},nRotations:{get:function(){return f.rotations.length}},rotationIsPossible:{get:function(){return f.rotations.length<99}},undoIsPossible:{get:function(){return f.rotations.length>0}},undo:{value:function(){n.undo.call(this,f)}},redoIsPossible:{get:function(){return f.futureRotations.length>0}},redo:{value:function(){n.redo.call(this,f)}},isFinished:{get:function(){return f.isFinished}},lastRotation:{get:function(){return f.lastRotation}},name:{get:function(){return r}},hiscores:{get:function(){return l}}}),e.load(u(r,"start"),function(e){s(a,e,i)}),e.load(u(r,"end"),function(e){o(a,e,i)})}var n;return n=Object.create(null,{rotate:{value:function(e,t){var n=t.rectT,r=t.cw,i=this.tiles;e.rotations.push(t),e.futureRotations.length=0,p(this.tiles,t),v(e,this),e.lastRotation=t}},undo:{value:function(e){var t=e.rotations.pop();t!==undefined&&(e.futureRotations.push(t),d(this.tiles,t),v(e,this),e.lastRotation=t.inverse)}},redo:{value:function(e){var t=e.futureRotations.pop();t!==undefined&&(e.rotations.push(t),p(this.tiles,t),v(e,this),e.lastRotation=t)}}}),Object.create(null,{load:{value:m}})}),n("boards",["board_factory"],function(e){function i(){var e;for(e=0;e<r.length;e+=1)if(n[e]===undefined)return!1;return!0}var t=0,n,r=["13","smiley","invaders","house","rgbcmy"];return n=Object.create([],{load:{value:function(t){this.length=r.length,r.forEach(function(r,s){e.load(r,function(e){n[s]=e,i()&&t()})})}},selected:{get:function(){return this[t]}},selectedI:{get:function(){return t},set:function(e){t=e}}}),n}),n("util",[],function(){return Object.create(null,{whenDocumentIsReady:{value:function(e){document.readyState==="complete"?e():document.addEventListener("readystatechange",function(){document.readyState==="complete"&&e()})}},clear:{value:function(e){while(e.firstChild)e.removeChild(e.firstChild)}},viewportPos:{value:function(e){var t=e.getBoundingClientRect();return[t.left,t.top]}}})}),n("rect_t_factory",[],function(){var e,t;return t=function(e,t){return e[0]===t[0]&&e[1]===t[1]},e=Object.create([],{isEqualTo:{value:function(e){return t(this[0],e[0])&&t(this[1],e[1])}},widthT:{get:function(){return this[1][0]-this[0][0]}},heightT:{get:function(){return this[1][1]-this[0][1]}},centerT:{get:function(){return[(this[0][0]+this[1][0])/2,(this[0][1]+this[1][1])/2]}},contains:{value:function(e){var t=e[0],n=e[1];return t>=this[0][0]&&n>=this[0][1]&&t<=this[1][0]&&n<=this[1][1]}},isSquare:{get:function(){return this.widthT===this.heightT}}}),Object.create(null,{create:{value:function(t,n){var r=Object.create(e);return r.push(t),r.push(n),r}}})}),n("display_c_sys",["boards"],function(e){function o(){var e;n!==undefined&&(e=n.sideLenT,i=s?0:.05*t/e,r=(t-i*(e+1))/e)}var t,n,r=0,i=0,s=!1;return Object.create(null,{sideLen:{set:function(e){e!==t&&(t=e,o())}},animStep:{value:function(){e.selected!==n&&(n=e.selected,o())}},posFromPosT:{value:function(e){return e.map(function(e){return e*(r+i)+i})}},posTFromPos:{value:function(e){return e.map(function(e){return(e-i)/(r+i)})}},decIfInSpacing:{value:function(e){return e.map(function(e){var t=e%(r+i);return e>0&&t<i?e-t-r/2:e})}},incIfInSpacing:{value:function(e){return e.map(function(e){var t=e%(r+i);return e>0&&t<i?e-t+i+r/2:e})}},posTInBounds:{value:function(e){return e.map(function(e){return Math.min(Math.max(e,0),n.sideLenT-1)})}},tileSideLen:{get:function(){return r}},spacing:{get:function(){return i}},disableSpacing:{value:function(){s=!0,o()}},enableSpacing:{value:function(){s=!1,o()}}})}),n("display_canvas_factory",[],function(){function e(e,t){e.isVisible?(t.style.display="block",e.needsToBeRendered=!0):t.style.display="none",e.visibilityNeedsToBeUpdated=!1}function t(e){e.isVisible||(e.isVisible=!0,e.visibilityNeedsToBeUpdated=!0)}function n(e){e.isVisible&&(e.isVisible=!1,e.visibilityNeedsToBeUpdated=!0)}return Object.create(null,{create:{value:function(){var r={isVisible:!0,visibilityNeedsToBeUpdated:!0};return Object.create(null,{visibilityNeedsToBeUpdated:{get:function(){return r.visibilityNeedsToBeUpdated}},isVisible:{get:function(){return r.isVisible}},updateVisibility:{value:function(t){e(r,t)}},show:{value:function(){t(r)}},hide:{value:function(){n(r)}}})}}})}),n("rubber_band_canvas",["util","rect_t_factory","display_c_sys","display_canvas_factory"],function(e,t,n,r){function m(){return u[0]-o[0]}function g(){return u[1]-o[1]}function y(e){var t=e.getContext("2d");e.height=e.width=i,h=.005*i,t.strokeStyle="#fff",t.lineWidth=h,t.lineJoin="round",t.strokeRect(o[0],o[1],m(),g())}function b(){return[Math.min(o[0],u[0]),Math.min(o[1],u[1])]}function w(){return[Math.max(o[0],u[0]),Math.max(o[1],u[1])]}function E(){var e=n.incIfInSpacing(b()),r=n.decIfInSpacing(w()),i=n.posTInBounds(n.posTFromPos(e).map(Math.floor)),s=n.posTInBounds(n.posTFromPos(r).map(Math.floor));a=t.create(i,s)}function S(){f=u[0]>o[0]}function x(){s=e.viewportPos(document.getElementById("rubberBandCanvas"))}function T(e){x(),u=o=[e[0]-s[0],e[1]-s[1]],E(),S(),c=!0,l=!0,d!==undefined&&d()}function N(e){u=[e[0]-s[0],e[1]-s[1]],E(),S(),l=!0,p!==undefined&&p(a,f)}function C(){c=!1,l=!0,o=u=[0,0],E(),S(),v!==undefined&&v()}function k(e){T([e.pageX,e.pageY])}function L(e){var t;e.preventDefault(),t=e.changedTouches,t.length>0&&T([t[0].pageX,t[0].pageY])}function A(e){c&&N([e.pageX,e.pageY])}function O(e){var t=e.changedTouches;e.preventDefault(),c&&t.length>0&&N([t[0].pageX,t[0].pageY])}function M(e){c&&C()}function _(e){var t=e.changedTouches;e.preventDefault(),c&&C()}var i,s,o=[0,0],u=[0,0],a=t.create([0,0],[0,0]),f,l=!0,c=!1,h=1,p,d,v;return e.whenDocumentIsReady(function(){var e=document.getElementById("rubberBandCanvas");e.addEventListener("mousedown",k),e.addEventListener("touchstart",L),window.addEventListener("mousemove",A),window.addEventListener("touchmove",O),window.addEventListener("mouseup",M),window.addEventListener("touchend",_),window.addEventListener("touchcancel",_)}),Object.create(r.create(),{animStep:{value:function(){var e=document.getElementById("rubberBandCanvas");this.visibilityNeedsToBeUpdated&&(this.updateVisibility(e),this.isVisible&&(l=!0)),l&&(y(e),l=!1)}},isBeingDragged:{get:function(){return c}},sideLen:{set:function(e){e!==i&&(i=e,l=!0)}},onDragStart:{set:function(e){d=e}},onDrag:{set:function(e){p=e}},onDragEnd:{set:function(e){v=e}}})}),n("rot_anim_canvas",["boards","display_c_sys","display_canvas_factory"],function(e,t,n){function h(e,n,r){var s=t.posFromPosT(n),o=i[n[0]][n[1]].color,u=t.tileSideLen;e.fillStyle=o,e.fillRect(s[0]-r[0],s[1]-r[1],u,u)}function p(e){var n,i,s=e.getContext("2d"),u=o[0][0],a=o[0][1],l=o[1][0],c=o[1][1],p=t.posFromPosT(o.centerT),d=[p[0]+t.tileSideLen/2,p[1]+t.tileSideLen/2];e.width=e.height=r,s.save(),s.translate(d[0],d[1]),s.rotate(f);for(n=u;n<=l;n+=1)for(i=a;i<=c;i+=1)h(s,[n,i],d);s.restore()}function d(){return Date.now()-u}function v(){return l<0?f<=0:f>=0}function m(){var e=.004;f=a+l*e*d(),v()&&(f=0)}var r,i,s,o,u,a,f,l,c;return Object.create(n.create(),{animStep:{value:function(){var e=document.getElementById("rotAnimCanvas");this.visibilityNeedsToBeUpdated&&this.updateVisibility(e),s&&(m(),v()?(s=!1,this.hide()):p(e))}},sideLen:{set:function(e){r=e}},animIsRunning:{get:function(){return s}},isInRotRect:{value:function(e){return o.contains(e)}},startAnim:{value:function(t){c=e.selected,i=c.tiles.copy(),o=t.rectT,s=!0,u=Date.now(),l=-t.direction,a=t.angleRad,this.show()}}})}),n("arrow_canvas",["display_c_sys","display_canvas_factory"],function(e,t){function o(e,t,n,r,i){var s=0,o=i===90||i===-90?Math.PI/2:Math.PI;i>0?s-=Math.PI/8:o+=Math.PI/8,e.beginPath(),e.arc(t+10*r,n+10*r,1.5*r,s,o),e.stroke()}function u(e,t,n,r,i){var s;e.beginPath(),i===90||i===180||i===-180?(s=i===-180?-3*r:0,e.moveTo(t+10*r+s,n+10*r),e.lineTo(t+13*r+s,n+10*r),e.lineTo(t+11.5*r+s,n+8*r),e.lineTo(t+10*r+s,n+10*r)):(e.moveTo(t+10*r,n+10*r),e.lineTo(t+8*r,n+11.5*r),e.lineTo(t+10*r,n+13*r),e.lineTo(t+10*r,n+10*r)),e.fill(),e.closePath()}function a(t,n,r){var i=e.posFromPosT(n),s=i[0],a=i[1],f=e.tileSideLen,l=f/14;t.lineWidth=l,o(t,s,a,l,r),u(t,s,a,l,r)}function f(e){var t=e.getContext("2d");e.height=e.width=n,i!==undefined&&i.makesSense&&a(t,i.rectT[1],i.angleDeg)}var n,r=!1,i,s;return s=Object.create(t.create(),{animStep:{value:function(){var e=document.getElementById("arrowCanvas");this.visibilityNeedsToBeUpdated&&(this.updateVisibility(e),this.isVisible&&(r=!0)),r&&(f(e),r=!1)}},rotation:{set:function(e){if(i===undefined||!i.isEqualTo(e))i=e,this.isVisible&&(r=!0)}},sideLen:{set:function(e){e!==n&&(n=e,this.isVisible&&(r=!0))}}}),s.hide(),s}),n("rotation_factory",[],function(){function t(t,n){return Object.create(e,{rectT:{get:function(){return t},enumerable:!0},cw:{get:function(){return n},enumerable:!0}})}var e;return e=Object.create(null,{isEqualTo:{value:function(e){return this.rectT.isEqualTo(e.rectT)&&this.cw===e.cw}},makesSense:{get:function(){return this.rectT.widthT>0||this.rectT.heightT>0}},direction:{get:function(){return this.cw?-1:1}},angleRad:{get:function(){return this.direction*(this.rectT.isSquare?Math.PI/2:Math.PI)}},angleDeg:{get:function(){return this.direction*(this.rectT.isSquare?90:180)}},inverse:{get:function(){return t(this.rectT,!this.cw)}}}),Object.create(null,{create:{value:t}})}),n("tiles_canvas",["boards","rubber_band_canvas","rot_anim_canvas","arrow_canvas","display_c_sys","display_canvas_factory","rotation_factory","rect_t_factory"],function(e,t,n,r,i,s,o,u){function g(){h===undefined?v=undefined:v=o.create(h,p)}function y(){return f===undefined||!l.tiles.areEqualTo(f)}function b(){return d===undefined||d!==n.animIsRunning}function w(){return l===undefined||l!==e.selected}function E(){r.show()}function S(e,t){if(h===undefined||!e.isEqualTo(h)||t!==p)h=e,p=t,c=!0,g(),r.rotation=v}function x(){var n=e.selected;n.isFinished||!n.rotationIsPossible?t.hide():t.show()}function T(){v!==undefined&&v.makesSense&&!e.selected.isFinished&&e.selected.rotate(v),x(),r.hide(),h=undefined,g(),c=!0}function N(e){return t.isBeingDragged&&h!==undefined&&e[0]>=h[0][0]&&e[0]<=h[1][0]&&e[1]>=h[0][1]&&e[1]<=h[1][1]}function C(e,r){var s=i.posFromPosT(r),o=f[r[0]][r[1]].color,u=t.isBeingDragged,a=i.tileSideLen,l=i.spacing===0?1:0;if(n.animIsRunning&&n.isInRotRect(r))return;e.globalAlpha=u&&N(r)?.5:1,e.fillStyle=o,e.fillRect(s[0],s[1],a+l,a+l)}function k(){var e,t,r=l.sideLenT,s=document.getElementById("tilesCanvas"),o=s.getContext("2d"),u=l.isFinished&&!n.animIsRunning;s.height=s.width=a,u&&i.disableSpacing();for(e=0;e<r;e+=1)for(t=0;t<r;t+=1)C(o,[e,t]);u&&i.enableSpacing()}function L(){var e=l.lastRotation;e!==null&&n.startAnim(e)}function A(e){f=l.tiles.copy(),e||L(),x(),r.hide()}function O(){var e=o.create(u.create([0,0],[f.widthT-1,f.heightT-1]),!0);n.startAnim(e)}var a,f,l,c=!0,h,p,d,v,m=!0;return t.onDragStart=E,t.onDrag=S,t.onDragEnd=T,Object.create(s.create(),{animStep:{value:function(){var t;w()?(c=!0,l=e.selected,t=!0):t=!1,y()&&(A(t),c=!0),m&&(O(),m=!1),b()&&(c=!0,d=n.animIsRunning),c&&(k(),c=!1)}},sideLen:{set:function(e){e!==a&&(a=e,c=!0)}}})}),n("display",["tiles_canvas","arrow_canvas","rubber_band_canvas","rot_anim_canvas","display_c_sys"],function(e,t,n,r,i){function a(){return document.getElementById("display").style}function f(){var e=a();e.width=u.sideLen+"px",e.height=u.sideLen+"px",e.top=u.top+"px"}var s=!1,o=!0,u={width:1,height:1,left:0,top:0};return Object.create(null,{animStep:{value:function(){s&&(o&&(f(),o=!1),i.animStep(),e.animStep(),t.animStep(),n.animStep(),r.animStep())}},layout:{set:function(s){u=s,i.sideLen=u.sideLen,e.sideLen=u.sideLen,t.sideLen=u.sideLen,n.sideLen=u.sideLen,r.sideLen=u.sideLen,o=!0}},isVisible:{set:function(){s=!0}}})}),n("title",[],function(){function n(){return document.getElementById("title").style}function r(){var e=n();e.lineHeight=e.height=t.height+"px",e.fontSize=.8*t.height+"px",t.portrait?(e.left=0,e.marginLeft=t.leftMargin+"px",e.textAlign="left",e.width="auto"):(e.left=t.left+"px",e.marginLeft=0,e.textAlign="center",e.width=t.width+"px")}var e=!0,t={width:1,height:1,portrait:!1};return Object.create(null,{animStep:{value:function(){e&&(r(),e=!1)}},layout:{set:function(n){t=n,e=!0}}})}),n("rotations_navigator",["boards","util"],function(e,t){function o(){return document.getElementById("rotationsNavigator").style}function u(e){return document.querySelector("#rotationsNavigator>."+e+".button")}function a(){r.undo()}function f(){r.redo()}function l(e){if(e.ctrlKey)switch(e.keyCode){case 90:r.undo();break;case 89:r.redo()}else e.metaKey&&e.keyCode===90&&(e.shiftKey?r.redo():r.undo())}function c(e,t){u(e).addEventListener("click",t)}function h(e,t){var n=e+" button";t&&(n+=" disabled"),u(e).className=n}function p(){h("undo",!r.undoIsPossible)}function d(){h("redo",!r.redoIsPossible)}function v(){var e=o();e.width=s.width+"px",e.lineHeight=e.height=s.height+"px",e.fontSize=.8*s.height+"px",e.top=s.top+"px",s.portrait?(e.left="auto",e.right=0,e.marginRight=s.rightMargin+"px",e.width="auto",e.textAlign="right"):(e.left=s.left+"px",e.right="auto",e.marginRight=0,e.width=s.width,e.textAlign="center"),document.getElementById("nRotations").textContent=n,p(),d()}var n,r,i=!0,s={width:1,height:1,left:0,top:0};return t.whenDocumentIsReady(function(){c("undo",a),c("redo",f),window.addEventListener("keyup",l)}),Object.create(null,{animStep:{value:function(){e.selected!==r&&(r=e.selected,i=!0),r.nRotations!==n&&(n=r.nRotations,i=!0),i&&(v(),i=!1)}},layout:{set:function(e){s=e,i=!0}}})}),n("hiscores_table",["util","boards"],function(e,t){function l(){return document.getElementById("hiscoresTableGroup")}function c(){return document.querySelector("#hiscoresTableGroup>table")}function h(){return document.querySelector("#hiscoresTableGroup>table.cont")}function p(e){var t=document.createElement("td");return t.appendChild(document.createTextNode(e)),t}function d(e){var t=document.createElement("tr");return t.appendChild(p(e.name)),t.appendChild(p(e.nRotations)),t}function v(){n.hiscores.nameInProposal=r.value}function m(){o&&(n.hiscores.nameInProposal=r.value,n.hiscores.saveProposal(),u=!0)}function g(){var e;i!==undefined&&(e="submit button"+(o?"":" disabled"),i.className=e)}function y(){o=r.value!=="",g()}function b(e){y(),e.keyCode===13&&m()}function w(e){var t=document.createElement("td");return r===undefined&&(r=document.createElement("input"),r.type="text",r.maxLength=r.size=n.hiscores.maxNameLen,r.spellcheck=!1,r.addEventListener("blur",v),r.addEventListener("keyup",b),r.addEventListener("propertychange",y),r.addEventListener("input",y),r.addEventListener("paste",y)),r.value=e,t.appendChild(r),y(),t}function E(){var e=document.createElement("td");return i===undefined&&(i=document.createElement("span"),i.appendChild(document.createTextNode("↵")),i.addEventListener("click",m),g()),e.appendChild(i),e}function S(e){var t=document.createElement("tr");return t.className="input",t.appendChild(w(e.name)),t.appendChild(E()),t.addEventListener("mouseup",function(){r.focus()}),t}function x(){var t=c(),i=h(),s=t,o=Math.ceil(n.hiscores.length/2);e.clear(t),e.clear(i),n.hiscores.forEach(function(e,t,n){n&&o>=4&&(o-=1),a.portrait&&t>=o&&(s=i),n?(s.appendChild(S(e)),r.focus()):s.appendChild(d(e))})}function T(){var e=l().style,t=c().style,n=h().style,r,i;t.tableLayout=n.tableLayout="fixed",e.width=a.width+"px",e.height=a.height+"px",e.top=a.top+"px",a.portrait?(n.display="table",r=Math.floor((a.width-2*a.horizontalMargin)/2),e.left=a.horizontalMargin+"px",n.left=r+2*a.horizontalMargin+"px",t.width=n.width=r+"px",i=a.height/4):(n.display="none",e.left=a.left+"px",t.width=e.width,i=a.height/7),n.lineHeight=t.lineHeight=i+"px",n.fontSize=t.fontSize=.85*i+"px",x()}var n,r,i,s,o=!1,u=!0,a={width:1,height:1,left:0,top:0,portrait:!1},f=0;return Object.create(null,{animStep:{value:function(){u=u||t.selected!==n||n.isFinished!==s||n.hiscores.version!==f,n=t.selected,s=n.isFinished,f=n.hiscores.version,u&&(T(),u=!1)}},layout:{set:function(e){a=e,u=!0}}})}),n("board_thumb_factory",["boards"],function(e){function t(e,t,n){return e.map(function(e){return e*t/n})}function n(e,n,r,i){var s=n.sideLenT,o=n.endTiles,u=t(r,i,s),a=o[r[0]][r[1]].color,f=i/s+1;e.fillStyle=a,e.fillRect(u[0],u[1],f,f)}function r(e,t,r){var i,s,o=t.sideLenT,u=e.getContext("2d");for(i=0;i<o;i+=1)for(s=0;s<o;s+=1)n(u,t,[i,s],r)}function i(e,t,n,i,s,o,u){var a=e.style;a.width=a.height=n+"px",a.left=s-n/2+"px",a.top=o-n/2+"px",u&&(e.width=e.height=i,r(e,t,i))}return Object.create(null,{create:{value:function(t,n){var r=document.createElement("canvas"),s=!0,o=!0,u=0,a=0,f=0,l=0;return r.addEventListener("click",function(){n(t)}),Object.create(null,{element:{get:function(){return r}},boardI:{set:function(e){e!==t&&(t=e,s=!0,o=!0)}},sideLen:{set:function(e){e!==a&&(a=e,s=!0)}},maxSideLen:{set:function(e){var t=Math.ceil(e);t!==u&&(u=t,s=!0,o=!0)}},x:{set:function(e){e!==f&&(f=e,s=!0)}},y:{set:function(e){e!==l&&(l=e,s=!0)}},animStep:{value:function(){s&&(i(r,e[t],a,u,f,l,o),s=!1,o=!1)}}})}}})}),n("boards_navigator",["boards","board_thumb_factory","util"],function(e,t,n){function w(){return document.getElementById("boardsNavigator").style}function E(t){return(t%e.length+e.length)%e.length}function S(e){return b.height/(1+.5*Math.abs(e-s))}function x(e){return(e-s)*(b.width/3)+b.width/2}function T(e){return 3*e/b.width-1.5+s}function N(){var e,t;i.forEach(function(e,t){var n=t-r;e.maxSideLen=S(0),e.sideLen=S(n),e.x=x(n),e.y=b.height/2})}function C(e){return E(o+e)}function k(){var e=Math.round(s);e!==0&&(o+=e,s-=e,l&&(u-=e,a-=e),g&&(d-=e),i.forEach(function(e,t){var n=t-r;e.boardI=C(n)}))}function L(e){u=s,a=e,f=a>u?1:-1,c=Date.now(),l=!0}function A(){l=!1}function O(e){L(e)}function M(n){return t.create(C(n),function(t){v&&(e.selectedI=t,O(n))})}function _(){var e;i.length=0;for(e=-r;e<=r;e+=1)i.push(M(e));N()}function D(){i.forEach(function(e){e.animStep()})}function P(e){i.forEach(function(t){e.appendChild(t.element)})}function H(){return i.length>0}function B(){var e=w();e.height=b.height+"px",e.top=b.top+"px",b.portrait?(e.left=0,e.margin="0 "+b.horizontalMargin+"px"):(e.left=b.left+"px",e.margin=0),e.width=Math.round(b.width)+"px",m&&H()&&(P(document.getElementById("boardsNavigator")),m=!1)}function j(){return Date.now()-c}function F(){return f>0&&s>=a||f<0&&s<=a}function I(){var e=.005;s=u+f*e*j(),F()&&(s=a,l=!1),k(),N()}function q(e){var t=n.viewportPos(document.getElementById("boardsNavigator")),r=e-t[0];A(),g=!0,h=e,p=r,d=s,v=!0}function R(t){var n=t-h,r=p+n,i=T(p)-T(r);n!==0&&(v=!1),s=d+i,k(),N(),e.selectedI=C(0)}function U(){L(0),g=!1}function z(e){q(e.pageX)}function W(e){var t;t=e.changedTouches,t.length>0&&q(t[0].pageX)}function X(e){g&&R(e.pageX)}function V(e){var t=e.changedTouches;g&&t.length>0&&R(t[0].pageX)}function $(){g&&U()}function J(e){var t=e.changedTouches;e.preventDefault(),g&&U()}var r=2,i=[],s=0,o=0,u,a,f,l=!1,c,h,p,d,v,m=!0,g=!1,y=!0,b={width:1,height:1,left:0,top:0};return n.whenDocumentIsReady(function(){var e=document.getElementById("boardsNavigator");e.addEventListener("mousedown",z),e.addEventListener("touchstart",W),window.addEventListener("mousemove",X),window.addEventListener("touchmove",V),window.addEventListener("mouseup",$),window.addEventListener("touchend",J),window.addEventListener("touchcancel",J)}),Object.create(null,{animStep:{value:function(){y&&(B(),y=!1),D(),l&&(I(),N())}},layout:{set:function(e){b=e,N(),y=!0}},activate:{value:function(){_(),y=!0}}})}),n("vendor/rAF",[],function(){var e=0,t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),s=window.setTimeout(function(){t(r+i)},i);return e=r+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}),n("game",["display","boards","title","rotations_navigator","hiscores_table","boards_navigator","util","vendor/rAF"],function(e,t,n,r,i,s,o){function c(t,o){var u=t-o,a=o,f=Math.round(.05*u),l=u-2*f,c=a+f;e.layout={sideLen:o,top:0},n.layout={portrait:!1,width:u,left:a,height:Math.round(.1*o)},s.layout={portrait:!1,width:l,height:Math.round((t-o)/4),left:c,top:Math.round(.99*o-(t-o)/4)},r.layout={portrait:!1,width:l,height:Math.round(.1*o),left:c,top:Math.round(.135*o)},i.layout={portrait:!1,width:l,height:Math.round(.5*o),left:c,top:Math.round(.28*o)}}function h(e,t){var n=e/t,r=document.body.style;n<a?(f=e,l=Math.round(f/a)):(l=t,f=Math.round(l*a)),r.width=f+"px",r.height=l+"px",r.margin=0,u&&c(f,l)}function p(t,o){var u=o-t,a,f,l=.01*t;f=0,a=Math.round(u*.2),n.layout={portrait:!0,height:a,leftMargin:l},r.layout={portrait:!0,height:a,top:f,rightMargin:l},f+=a,a=t,e.layout={sideLen:a,top:f},f+=a+u*.03,a=Math.round(u*.33),s.layout={portrait:!0,width:t-2*l,height:a,top:f,horizontalMargin:l},f+=a+u*.05,a=Math.round(u*.39),i.layout={portrait:!0,width:t-2*l,height:a,top:f,horizontalMargin:l}}function d(e,t){var n=e/t,r=document.body.style;f=e,l=t,n<1/a?l=Math.round(f*a):n>.75&&(f=Math.round(l*3/4)),r.width=f+"px",r.height=l+"px",r.margin="0 auto",u&&p(f,l)}function v(){var e=window.innerWidth,t=window.innerHeight;e>t?h(e,t):d(e,t)}function m(){e.animStep(),n.animStep(),s.animStep(),r.animStep(),i.animStep(),window.requestAnimationFrame(m)}function g(){v()}function y(){document.getElementById("loadScreen").style.display="none"}function b(){u=!0,y(),g(),window.addEventListener("resize",g),e.isVisible=!0,s.activate(),v(),m()}var u=!1,a=1.61803398875,f,l;o.whenDocumentIsReady(function(){t.load(b)})}),t(["game"])})()